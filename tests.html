<!DOCTYPE html>
<html>
<head>
  <title>Runloop Workshop: Exercise b</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.14.0.css">
  <script src='http://code.jquery.com/jquery.js'></script>
  <script src="http://code.jquery.com/qunit/qunit-1.14.0.js"></script>
  <script src='http://underscorejs.org/underscore.js'></script>
  <script src='http://backbonejs.org/backbone.js'></script>
  <script src='./runloop.js'></script>
</head>
<body>
  <div id="qunit"></div>
  <div id="ember-testing"></div>

<script>
module("Has tests");

test("has Runloop", function(){
  ok(Runloop, "Runloop exists");
});

test("Runloop.begin; schedule; end", function(){
  var itRan = false;

  Runloop.begin();

  Runloop.schedule(null, function(){
    itRan = true;
  });

  ok(!itRan, 'scheduling defers execution');

  Runloop.end();

  ok(itRan, 'scheduled task is run');
});

test("Runloop.schedule outside of runloop throws", function(){
  throws(function(){
    Runloop.schedule(null, function(){
      //
    });
  }, /without a runloop/,
     "includes an error message saying 'without a runloop'");
});

test("Runloop.schedule is applied with context", function(){
  var context = {itRan: false};

  Runloop.begin();
  Runloop.schedule(context, function(){
    this.itRan = true;
  });
  Runloop.end();

  ok(context.itRan, 'it ran with context');
});

test("Runloop.schedule'd tasks are run in correct order", function(){
  var itRans = [];

  Runloop.begin();

  Runloop.schedule(null, function(){
    itRans.push("first");
  });

  Runloop.schedule(null, function(){
    itRans.push("second");
  });

  Runloop.schedule(null, function(){
    itRans.push("third");
  });

  Runloop.end();

  deepEqual(itRans, ["first","second","third"],
            "scheduled tasks run in order");
});



</script>
</body>
</html>

